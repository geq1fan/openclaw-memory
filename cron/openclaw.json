{
  "jobs": [
    {
      "name": "memory-writer",
      "agentId": "kimi-agent",
      "enabled": true,
      "sessionTarget": "isolated",
      "wakeMode": "now",
      "schedule": {
        "kind": "every",
        "everyMs": 7200000
      },
      "payload": {
        "kind": "agentTurn",
        "timeoutSeconds": 120,
        "message": "你是记忆写入 Agent。严格执行以下步骤，不要做任何其他事情：\n\n1. 运行扫描脚本：\n```\npython3 /root/.openclaw/workspace/memory/scripts/memory-scanner.py --max-messages 100\n```\n脚本会自动读取并更新游标（.writer-state.json），你不需要手动更新。\n\n2. 从输出 JSON 的 sessions 数组中过滤，保留 user_message_count >= 3 的会话，跳过其余。\n\n3. 对每个有效会话，从 messages 数组提取关键内容：\n   - 保留：用户的问题/请求、assistant 的关键结论和决策、重要操作结果\n   - 丢弃：纯确认消息、重复内容\n   - 禁止脑补，只从实际消息提取\n\n4. 写入 memory/YYYY-MM-DD.md（按会话实际日期）：\n   - 幂等：先读取文件，如果 session_id 前 8 位已出现则跳过该会话\n   - 格式：## [agent_id] session:FIRST8 | HH:MM-HH:MM | N条消息\n   - 每个会话 5-15 条摘要\n\n5. 完成后回复 ANNOUNCE_SKIP（不需要通知主会话）。如无新内容也回复 ANNOUNCE_SKIP。"
      },
      "delivery": {
        "mode": "none"
      }
    },
    {
      "name": "memory-janitor",
      "agentId": "kimi-agent",
      "enabled": true,
      "sessionTarget": "isolated",
      "wakeMode": "now",
      "schedule": {
        "kind": "cron",
        "expr": "10 3,9,15,21 * * *",
        "tz": "Asia/Shanghai"
      },
      "payload": {
        "kind": "agentTurn",
        "message": "定时记忆整理任务。严格执行以下步骤：\n1. 变更检测（必须最先执行）：\nexec 执行: find /root/.openclaw/workspace/memory/ -maxdepth 1 -name '*.md' -newer /root/.openclaw/workspace/memory/.janitor-last-run 2>/dev/null | head -10\n如果 .janitor-last-run 不存在，视为有变更。\n如果命令无输出（没有更新的文件），静默结束，不执行后续步骤。\n2. 如果有变更，读取 memory/MEMORY_JANITOR_PROMPT.md，严格按照其中的指示依次执行所有阶段（包括阶段四 USER.md 同步）。\n3. 当前为 V1 写入模式：可修改 MEMORY.md（修改前自动备份）、可归档旧 daily 文件、可更新 USER.md。保守期规则：只允许新增、压缩、更新过时信息；不允许删除仍有效的条目。\n4. 重要路径：MEMORY.md 在 /root/.openclaw/workspace/MEMORY.md，USER.md 在 /root/.openclaw/workspace/USER.md（都在 workspace 根目录，不是 memory/ 下）。\n5. 全部完成后执行: touch /root/.openclaw/workspace/memory/.janitor-last-run\n6. 静默结束，不发任何通知。"
      },
      "delivery": {
        "mode": "none"
      }
    }
  ]
}
